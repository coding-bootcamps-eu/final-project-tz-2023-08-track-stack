<template>
  <small><active-dj>nicht eingeloggt</active-dj> @ WishList</small>

  <h2>Wunschliste</h2>
  <p>
    Hier findest du die bisher eingegangen Musikw√ºnsche, vote gerne, damit dein favorisierter Titel
    nach oben rutscht.
  </p>

  <ol>
    <li v-for="request in requests" :key="request.id">
      <details name="accordion">
        <summary role="button" class="grid outline contrast">
          <hgroup>
            <h3>{{ request.title }}</h3>
            <p>{{ request.artist }}</p>
          </hgroup>
          <p class="votes">
            <b>{{ request.likes }}</b> Stimmen gez√§hlt
          </p>
          <button>Abstimmen üëç</button>
        </summary>
        <section>
          <div role="group">
            <button class="contrast btn-play">abspielen</button>
            <button class="contrast btn-deny">ablehnen</button>
          </div>
          <figure>
            <figcaption>
              <!-- <time>23:55 Uhr</time>:  -->
              <strong>{{ request.who.name }}</strong>
            </figcaption>
            <blockquote>
              {{ request.message }}
            </blockquote>
          </figure>
          <hr />
          <!-- <figure>
            <figcaption><time>22:15 Uhr</time>: <strong>Larissa</strong></figcaption>
            <blockquote>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
              incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud
              exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
            </blockquote>
          </figure> -->
        </section>
      </details>
    </li>
  </ol>
  <div class="grid">
    <router-link to="/guest-overview">
      <button>Gast √úbersicht</button
      ><!-- muss dynamisch sein, Gast oder DJ -->
    </router-link>
    <router-link to="/dj-overview">
      <button>DJ √úbersicht</button
      ><!-- muss dynamisch sein, Gast oder DJ -->
    </router-link>
  </div>
</template>

<script>
import ActiveDj from '@/components/ActiveDj.vue'

export default {
  data() {
    return {
      // Die Requests f√ºr ein bestimmtes Event
      requests: [],
      eventId: null
    }
  },

  components: { ActiveDj },

  created() {
    this.getEventIdFromlocalStorage(), this.getRequestsFromApiForThisEvent()
  },

  methods: {
    async getRequestsFromApiForThisEvent() {
      try {
        const response = await fetch(`http://localhost:3000/requests?eventId=${this.eventId}`)

        if (!response.ok) {
          throw new Error('Fehler beim Senden der Daten')
        }

        const requestsFromApi = await response.json()
        this.requests = requestsFromApi

        // Da der Key "who" als JSON-String gespeichert ist, muss das who-Feld von JSON-String zum Objekt konvertiert werden
        this.requests = requestsFromApi.map((request) => {
          return {
            ...request,
            who: JSON.parse(request.who)
          }
        })

        console.log(this.requests)
      } catch (error) {
        console.error('Fehler:', error)
      }
    },

    getEventIdFromlocalStorage() {
      //EventId aus dem local Storage holen
      const eventDataFromLocalStorage = localStorage.getItem('eventData')
      if (eventDataFromLocalStorage) {
        const eventData = JSON.parse(eventDataFromLocalStorage)
        this.eventId = eventData.id
        console.log(this.eventId)
      }
    }
  }
}
</script>

<style scoped>
summary.grid {
  background: var(--pico-code-background-color);
  grid-template-columns: 1fr;

  @media (min-width: 768px) {
    grid-template-columns: 50% 1fr 1fr 5%;
  }
}
hgroup {
  margin-bottom: 0;
}
summary > * {
  align-content: center;
  justify-items: stretch;
  margin-bottom: 0;
}
details summary[role='button']::after {
  height: 100%;
}
</style>
